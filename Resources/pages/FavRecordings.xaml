<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="ECHO_PRINT.Resources.pages.FavRecordings"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    Title="Fav Recordings">

    <!-- background -->
    <ContentPage.Background>
        
        <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
            
            <GradientStop Color="#0B1220" Offset="0" />
            <GradientStop Color="#111827" Offset="1" />
            
        </LinearGradientBrush>
        
    </ContentPage.Background>

    <RefreshView x:Name="refresh" Refreshing="OnRefresh">
        <CollectionView x:Name="favList" SelectionMode="None"   ItemsLayout="VerticalList"  Margin="16,8">
            
            <CollectionView.ItemTemplate>
                
                <DataTemplate>

                    <!-- card -->
                    <Frame Padding="14"  Margin="0,10" CornerRadius="16" HasShadow="True"  BackgroundColor="#111827">
                        
                        <Frame.Shadow>
                            
                            <Shadow Brush="#55000000" Radius="16" Opacity="0.6" Offset="0,8"/>
                            
                        </Frame.Shadow>

                        
                        <VerticalStackLayout Spacing="12">

                            <!-- photo preview  -->
                            <Border HeightRequest="160" StrokeThickness="0" BackgroundColor="#1F2A37" StrokeShape="RoundRectangle 12">
                                
                                <Image Source="{Binding PhotoPath}" Aspect="AspectFill" HeightRequest="160">

                                    <Image.GestureRecognizers>
                                        
                                        <TapGestureRecognizer Tapped="OnPhotoTapped"  CommandParameter="{Binding}" />
                                        
                                    </Image.GestureRecognizers>
                                    
                                </Image>
                                
                                <Border.Triggers>
                                    
                                    <DataTrigger TargetType="Border"  Binding="{Binding PhotoPath}" Value="{x:Null}">
                                        
                                        <Setter Property="IsVisible" Value="False"/>
                                        
                                    </DataTrigger>
                                    
                                    <DataTrigger TargetType="Border"  Binding="{Binding PhotoPath}" Value="">
                                        
                                        <Setter Property="IsVisible" Value="False"/>
                                        
                                    </DataTrigger>
                                    
                                </Border.Triggers>
                                
                            </Border>
                            
                            <!-- photo picker -->
                            <Button Text="Attach Photo" CommandParameter="{Binding}" Clicked="MediaPcker" FontSize="12"  TextColor="White" BackgroundColor="#3A7CA5"  CornerRadius="12"  Padding="12,8" />
                            
                            <!-- title + Controls -->
                            <Grid ColumnDefinitions="*,Auto,Auto,Auto,Auto"  ColumnSpacing="12">

                                <!-- title -->
                                <Label Grid.Column="0" Text="{Binding Title}" TextColor="#E5E7EB" FontAttributes="Bold"  FontSize="16" LineBreakMode="TailTruncation" />



                                <!--  fav button -->
                                <Button Grid.Column="3" Text="â™¥" CommandParameter="{Binding}" Clicked="OnFav"   BackgroundColor="#00000000"  Padding="10,6" WidthRequest="44"  CornerRadius="12"  BorderWidth="1"  >
                                    
                                    <Button.Triggers>
                                        
                                        <DataTrigger TargetType="Button" Binding="{Binding IsFav}" Value="True">
                                            <Setter Property="TextColor" Value="#F25F5C"/>
                                            <Setter Property="BorderColor" Value="#F25F5C"/>
                                            
                                        </DataTrigger>
                                        
                                        <DataTrigger TargetType="Button" Binding="{Binding IsFav}" Value="False">
                                            
                                            <Setter Property="TextColor" Value="#9CA3AF"/>
                                            <Setter Property="BorderColor" Value="#334155"/>
                                            
                                        </DataTrigger>
                                        
                                    </Button.Triggers>
                                    
                                </Button>
                                
                                <!-- play button -->
                                <Button x:Name="PlayBtn"  Grid.Column="1"  Text="Play"  CommandParameter="{Binding}"  Clicked="OnPlay" BackgroundColor="#00000000" TextColor="#E5E7EB"  BorderColor="#334155"  BorderWidth="1" CornerRadius="12"  Padding="12,8" />

                                <!-- map button -->
                                <Button Grid.Column="2"  Text="ðŸ“"  CommandParameter="{Binding}"  Clicked="OpenMap"  BackgroundColor="#00000000" TextColor="#5FB2E6" BorderColor="#334155" BorderWidth="1" CornerRadius="12" Padding="10,6" WidthRequest="44">
                                    
                                    <!-- diabled when no location-->
                                    <Button.Triggers>
                                        
                                        <DataTrigger TargetType="Button"  Binding="{Binding Latitude}"  Value="{x:Null}">
                                            
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Opacity" Value="0.45"/>
                                            
                                        </DataTrigger>
                                        
                                        <DataTrigger TargetType="Button"  Binding="{Binding Latitude}" Value="NaN">
                                            
                                            <Setter Property="IsEnabled" Value="False"/>
                                            <Setter Property="Opacity" Value="0.45"/>
                                            
                                        </DataTrigger>
                                        
                                    </Button.Triggers>
                                    
                                </Button>


                                <!-- delete button -->
                                <Button Grid.Column="4"  Text="Delete"  CommandParameter="{Binding}"  Clicked="OnDelete"  TextColor="White"  BackgroundColor="#F25F5C"  CornerRadius="12"  Padding="12,8" />
                            </Grid>

                            <!-- meta data -->
                            <HorizontalStackLayout Spacing="14">
                                
                                <Label Text="{Binding CreatedOn, StringFormat='{}{0:dd MMM yyyy HH:mm}'}" FontSize="12" TextColor="#9CA3AF" />
                                
                                <Label Text="{Binding PlaceName}" FontSize="12"  TextColor="#9CA3AF" />
                                
                            </HorizontalStackLayout>

                            <!-- Progressbar -->
                            <ProgressBar x:Name="progressBar" HeightRequest="4" Progress="0"  IsVisible="False"  Margin="0,4,0,0" />

                        </VerticalStackLayout>
                    </Frame>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </RefreshView>
</ContentPage>
